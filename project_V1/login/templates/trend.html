<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.9">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Trend</title>
    <!-- Loading Scripts and Static Files -->
    {% load staticfiles %}
    <!-- Bootstrap CSS CDN -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css"
        crossorigin="anonymous">
    <!-- Our Custom CSS -->
    <link rel="stylesheet" href="{% static 'style.css' %}">

    <!-- Our Custom CSS -->
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/material-design-iconic-font/2.2.0/css/material-design-iconic-font.min.css">
    <!-- Our Custom CSS -->

    <!-- Font Awesome JS -->
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/solid.js"
        integrity="sha384-tzzSw1/Vo+0N5UhStP3bvwWPq+uvzCMfrN1fEFe+xBmv1C/AtVX5K0uZtmcHitFZ" crossorigin="anonymous">
    </script>
    <!-- Font Awesome JS 2 -->
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/fontawesome.js"
        integrity="sha384-6OIrr52G08NpOFSZdxxz1xdNSndlD4vdcf/q2myIUVO0VsqaGHJsB0RaBE01VTOY" crossorigin="anonymous">
    </script>
    <!-- JQuery  -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
    <script src='https://cdn.jsdelivr.net/lodash/4.17.2/lodash.min.js'></script>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <!-- Font Awesome 3 -->
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/solid.js"
        integrity="sha384-tzzSw1/Vo+0N5UhStP3bvwWPq+uvzCMfrN1fEFe+xBmv1C/AtVX5K0uZtmcHitFZ" crossorigin="anonymous">
    </script>
    <!-- Zingchart JS -->
    <script src="https://cdn.zingchart.com/zingchart.min.js"></script>
    <!-- loadash JS -->
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/lodash.js/0.10.0/lodash.min.js"></script>
    <!-- JQuery UI Stylesheet -->
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <!-- Font awesome 5  -->
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/fontawesome.js"
        integrity="sha384-6OIrr52G08NpOFSZdxxz1xdNSndlD4vdcf/q2myIUVO0VsqaGHJsB0RaBE01VTOY" crossorigin="anonymous">
    </script>
    <!-- Popper.JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"
        integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous">
    </script>
    <!-- Bootstrap JS -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" crossorigin="anonymous">
    </script>
    <!-- Trend Stylesheet -->
    <style>
        /* Text Colors */
        text {
            position: absolute;
            font-family: 'Fira Sans', sans-serif;
            color: #fff;
            font-weight: 700;
            margin-left: 50px;
            padding: 60px;
            font-size: 18px;
        }

        /* SVG Rectangle Colors */
        svg rect {
            background: rgb(255, 255, 255);
            padding: 10px;
            border: 5px solid #fff;
            color: rgb(255, 255, 255);
        }

        /* Circle Points on SVG */
        circle {
            fill: rgb(26, 60, 253);
            stroke: rgb(0, 0, 0);
            stroke-width: 1.5px;
            cursor: pointer;

        }

        /* Axis lines */
        .axis path,
        .axis line {
            fill: none;
            color: #111;
            stroke: #111;
            stroke-width: 2px;
            shape-rendering: crispEdges;
        }

        /* Axis Title */
        .axis-title {
            fill: #111;
            letter-spacing: 1px;
        }

        /* SVG Trend Line */
        .line {
            fill: none;
            stroke: #111;
            stroke-width: 5px;
        }

        /* SVG overlay  */
        .overlay {
            fill: none;
            margin: 30px;
            pointer-events: all;
        }

        /* Hover Line  */
        .hover-line {
            stroke: #111;
            stroke-width: 2px;
            stroke-dasharray: 2, 4;
        }

        /* On Focus Circle Points  */
        .focus {
            background: #fff;
            background-color: #fff;
            padding: 10px;
            border: 5px solid #fff;
            color: #fff;
        }

        /* Legend  */
        .legend .series {
            cursor: pointer;
        }

        .legend circle {
            stroke-width: 2px;
        }

        .legend .disabled circle {
            fill-opacity: 0;
        }

        .y.axis line {
            stroke: red;
        }

        .y.axis text {
            font-size: 14px;
            font-weight: 500;
        }
    </style>

</head>

<body oncontextmenu="return false;">
    <!-- wrapper for the page -->
        <div class="wrapper">   
        <!-- Sidebar  -->
        <nav id="sidebar">
            <div class="sidebar-header text-align-center">
            </div>

            <ul class="list-unstyled components">
                <li class="active">
                    <a href="/home/submit">
                        <i class="fas fa-home"></i>
                        &nbsp; dashboard
                    </a>

                </li>
                <li>
                    <a href="/core/follower">
                        <i class="fas fa-user-plus"></i>
                        &nbsp; followers
                    </a>

                    <div class="collapse list-unstyled" id="pageSubmenu">

                    </div>
                </li>

                <li>
                    <a href="/home/about">
                        <i class="fa fa-info-circle" aria-hidden="true"></i>
                        &nbsp; help
                    </a>
                </li>
            </ul>


        </nav>

        <!-- Page Content  -->
        <div id="content">
            <!-- navigation bar -->
            <nav class="navbar default-layout col-lg-12 col-12 p-0 fixed-top d-flex flex-row">
              <!-- navigation bar logo  -->
                <div class="text-center navbar-brand-wrapper d-flex align-items-top justify-content-center">
                    <a class="navbar-brand brand-logo" href="/home/submit">
                        <img src="{%static 'images/buddyup-logo.png'%}" alt="logo"
                            style="width: 170px; height:70px;margin-left:0;" /> </a>
                    <a class="navbar-brand brand-logo-mini" href="/home/submit">
                        <img src="#" alt="logo" /> </a>
                </div>
                <!-- navigation bar profile section  -->
                <div class="navbar-menu-wrapper d-flex align-items-center">
                    <ul class="navbar-nav ml-auto">
                        <form action="/home/personalisation?twitter_handle={{friend}}" method="GET">
                            {%csrf_token%}
                            <ul>
                                <a href="/home/personalisation?twitter_handle={{friend}}" class="btn btn-info"
                                    id="help_btn" role="button">Help us get better</a>
                            </ul>
                        </form>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        <li class="nav-item dropdown d-none d-xl-inline-block">
                            <a class="nav-link" id="UserDropdown" data-toggle="dropdown" aria-expanded="false"
                                style="cursor: pointer;">
                                <i class="fa fa-user-circle" aria-hidden="true"></i> &nbsp;{{ usr}} &nbsp;<i
                                    class="fa fa-angle-down" aria-hidden="true"></i>
                                <div class="dropdown-menu dropdown-menu-right navbar-dropdown"
                                    aria-labelledby="UserDropdown">
                                    <a class="dropdown-item" href="/logout/logout">Sign Out&nbsp;<i
                                            class="fas fa-sign-out-alt    "></i></a>
                                </div>
                        </li>
                    </ul>
                    <button class="navbar-toggler navbar-toggler-right d-lg-none align-self-center" type="button"
                        data-toggle="offcanvas">
                        <span class="mdi mdi-menu"></span>
                    </button>
                </div>
            </nav>
            <!-- content area -->
            <div class="content-wrapper">
                <h2>{{friend}}'s well being overview</u> </h2>
                {%if summ == 'No'%}

                <p style="width:96%; margin-left:2%;  box-shadow: 0 2px 4px 0 rgba(0, 0, 0, 0.2),
                    0 1px 1px 0 rgba(0, 0, 0, 0.19);border-radius: 10px; text-align: center;color: #111; background:
                    #ffffff; font-weight: 600;font-size:
                    24px;">

                    No Tweets in last 10 days
                </p>
                {%else%}
                <p style="width:96%; margin-left:2%;  box-shadow: 0 2px 4px 0 rgba(0, 0, 0, 0.2),
                                        0 1px 1px 0 rgba(0, 0, 0, 0.19);border-radius: 10px; text-align: center;color: #111; background:
                                        #ffffff; font-weight: 600;font-size:
                                        24px;">

                    The overall well being of <b style="color:#5f2ceb"><u>@{{friend}}</u></b> in the past 10 days is
                    <b style="color:#5f2ceb"><u>{{summ}}</u></b>. For
                    more
                    details, please view the trend below.
                </p>
                {%endif%}
                <div class="row m-b-1">
                    <div class="col-12">
                        <div class="card shadow" id="trend">
                            <svg class="showTrend"
                                style="width:100%; height:100%;background:transparent;position: static; " width="1260"
                                height="700" viewBox="0 0 1260 700" preserveAspectRatio="xMidYMid meet">
                            </svg>
                        </div>
                        <div class="feedback-container-head" style="width:100%"></div>
                        <div class="onclick-container">
                            <div class="feedback-form" style="overflow-y:auto;height:500px"></div>
                            <div id="wordcloud"></div>
                        </div>
                        <div class="wordchart-container" style="justify-content: center; align-items: center">
                        </div>
                        <div class="tweet-chart" id="chartContainer" style="height: 400px; width: 90%;">
                        </div>


                        <button class="btn btn-primary" id="top" onclick="topFunction()" type="button">Scroll
                            Top</button>

                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>

    <!-- Importing Chart Libraries  -->
    <script src="//d3js.org/d3.v4.min.js"></script>
    <script src="//d3js.org/d3-color.v1.min.js"></script>
    <script src="//d3js.org/d3-interpolate.v1.min.js"></script>
    <script src="//d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="//canvasjs.com/assets/script/canvasjs.min.js"></script>
    <script src="//rawgit.com/jasondavies/d3-cloud/master/build/d3.layout.cloud.js"></script>

    <!-- Trend Script -->
    <script>
        // Functipn to remove stop words
        String.prototype.removeStopWords = function () {
            var x;
            var y;
            var word;
            var stop_word;
            var regex_str;
            var regex;
            var cleansed_string = this.valueOf();
            var stop_words = new Array("a", "about", "above", "after", "again", "against", "all", "am", "an",
                "and",
                "any", "are", "aren't", "as", "at", "be", "because", "been", "before", "being", "below",
                "between", "both", "but", "by", "can't", "cannot", "could", "couldn't", "did", "didn't",
                "do", "does", "doesn't", "doing", "don't", "down", "during", "each", "few", "for", "from",
                "further", "had", "hadn't", "has", "hasn't", "have", "haven't", "having", "he", "he'd",
                "he'll", "he's", "her", "here", "here's", "hers", "herself", "him", "himself", "his", "how",
                "how's", "i", "i'd", "i'll", "i'm", "i've", "if", "in", "into", "is", "isn't", "it", "it's",
                "its", "itself", "let's", "me", "more", "most", "mustn't", "my", "myself", "no", "nor",
                "not", "of", "off", "on", "once", "only", "or", "other", "ought", "our", "ours",
                "ourselves", "out", "over", "own", "same", "shan't", "she", "she'd", "she'll", "she's",
                "should", "shouldn't", "so", "some", "such", "than", "that", "that's", "the", "their",
                "theirs", "them", "themselves", "then", "there", "there's", "these", "they", "they'd",
                "they'll", "they're", "they've", "this", "those", "through", "to", "too", "under", "until",
                "up", "very", "was", "wasn't", "we", "we'd", "we'll", "we're", "we've", "were", "weren't",
                "what", "what's", "when", "when's", "where", "where's", "which", "while", "who", "who's",
                "whom", "why", "why's", "with", "won't", "would", "wouldn't", "you", "you'd", "you'll",
                "you're", "you've", "your", "yours", "yourself", "yourselves");
            // Split out all the individual words in the phrase
            words = cleansed_string.match(/[^\s]+|\s+[^\s+]$/g)

            // Review all the words
            for (x = 0; x < words.length; x++) { // For each word, check all the stop words 
                for (y = 0; y < stop_words.length; y++) { // Get the current word 
                    word = words[x].replace(/\s+|[^a-z]+/ig, ""); // Trim the word and remove non-alpha //
                    // Get the stop word 
                    stop_word = stop_words[y]; // If the word matches the stop word, remove it from the keywords
                    if (word.toLowerCase() == stop_word) { // Build the regex 
                        regex_str = "^\\s*" + stop_word + "\\s*$"; // Only word
                        regex_str += "|^\\s*" + stop_word + "\\s+"; // First word 
                        regex_str += "|\\s+" + stop_word + "\\s*$"; // Last word
                        regex_str += "|\\s+" + stop_word + "\\s+"; // Word somewhere in the middle 
                        regex = new RegExp(regex_str, "ig"); //
                        //Remove the word from the keywords 
                        cleansed_string = cleansed_string.replace(regex, " ");
                    }
                }
            }
            return cleansed_string.replace(/^\s+|\s+$/g, ""); // returning clean string 
        }

        // Function to calculate word frequency 
        function wordFreq(string) {
            var words = string.replace(/[.]/g, '').split(/\s/);
            var freqMap = {};
            words.forEach(function (w) {
                if (!freqMap[w]) { //Checking if there are any repetetive words 
                    freqMap[w] = 0; // if there is only one word 
                }
                freqMap[w] += 1;   // If more than one same word 
            });
            return freqMap; 
        }

        // Appending word and frequency in a dictionary 
        var wordfrequency = [];
        Object.keys(new_bar).forEach(function (key) {
            wordfrequency.push({ 
                "x": key,
                "value": new_bar[key]
            })
        });
    </script>
    <script>
        // Importing data from task.py in JSON format 
        var data1 = {{obj1 | safe}};
        var data2 = _.groupBy(data1, function (obj1) {
            return obj1.tweet_date.substring(0, 10);
        });
        
        var myFormat = d3.timeFormat("%Y-%m-%d")
        var myFormat2 = d3.timeFormat("%X");
        var parseTime = d3.timeParse(myFormat);
        var parseTime2 = d3.timeParse(myFormat2)
        
        data = []
        tweet_data = []
        
        // Function to create dictionary for Tweets data 
        Object.keys(data2).forEach(function (key) {
            // console.log(key, data[key]);
            var score = 0;
            var count = 0;
            var tweets = [];
            var tweet_score = [];
            var time = [];
            var is_noti = [];
            data2[key].forEach(function (d) {
                score = (score + d.tweet_sum_score); // Score of the tweet 
                count = count + d.tweet_counter; // Tweet Counter 
                tweets.push(d.tweet_data); // appending tweets to tweet_data array
                tweet_score.push(d.tweet_score) // appending score to tweet_data array
                time.push(d.tweet_date) // appending time to tweet_data array
                is_noti.push(d.is_noti) // appending notified tweet to tweet_data array 
            });
            if (count == 0) { // if count is 0 
                data.push({  
                    "date": parseTime(key), // push date to data 
                    "score": 0, //push score 0 to 
                    "tweet": tweets, //push tweets to data  
                    "t_score": tweet_score, // push tweet score to data 
                    "time": time, // push time of the tweet to data 
                    "is_noti": is_noti // push notified tweet to data 
                });
            } else { // if count is not 0
                data.push({
                    "date": parseTime(key), // push date to data 
                    "score": (score / count), // push fraction of score and count to data 
                    "tweet": tweets, // push tweets to data 
                    "t_score": tweet_score, // push tweet_score to data 
                    "time": time, // push time to data
                    "is_noti": is_noti // push notified tweet to data 
                });
            }
        });

        // Trend Code begins 
        var svg = d3.select("svg") // selecting svg from svg element 
        margin = {
                top: 20,
                right: 30,
                bottom: 80,
                left: 200
            },
            width = +svg.attr("width") - margin.left - margin.right; //width 
        height = +svg.attr("height") - margin.top - margin.bottom; //height 


        bisectDate = d3.bisector(function (d) { // bisecting the date in readable format 
            return d.date;
        }).left;


        var colour = d3.scaleOrdinal(d3.schemeCategory10); // Color scheme for the chart 

        // X-axis range and points 
        var x = d3.scaleTime()  
            .domain(d3.extent(data, function (d) {
                return d.date
            }))
            .range([0, width]);
        
        // Y-axis range and points 
        var y = d3.scaleLinear().domain([-5, 5]).range([height, 30]);

        // Appending Rectangle to SVG 
        var rect = svg.append("rect")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
            .attr("class", "overlay")
            .attr("id", "line01")
            .attr("width", width)
            .style("background-color", 'white')
            .attr("height", height)
            .order("", 10)
            .on("mouseover", function () {
                focus.style("display", null)
                focus.style("color", "white");
            })
            .on("mouseout", function () {
                focus.style("display", "none");
            })
            .on("click", onClickEvent)

        // Appending Circle to SVG 
        svg.append("circle")    
            .attr("width", 10)
            .attr("height", 10)
            .attr("cx", 1103)
            .attr("cy", 95)
            .attr("r", 7)
            .style("fill", "rgb(26, 60,253)");

        // Appending Legend Text to SVG
        svg.append("text")
            .attr("class", "legendTitle")
            .attr("x", 1140)
            .attr("y", 100)
            .style("text-anchor", "left")
            .style("font-size", "15px")
            .style("font-weight", "700")
            .text("Days Tweeted");

        // Appending Sentiment Red Zone to SVG
        svg.append("rect")
            .attr("width", "82%")
            .attr("transform", "translate(200," + height / 1.54 + ")")
            .attr("height", height / 10.3)
            .attr("fill", "#FF2700")
            .attr("opacity", 0.2);
        svg.append("rect")
            .attr("width", "82%")
            .attr("transform", "translate(200," + height / 1.343 + ")")
            .attr("height", height / 10.3)
            .attr("fill", "#FF2700")
            .attr("opacity", 0.5);
        svg.append("rect")
            .attr("width", "82%")
            .attr("transform", "translate(200," + height / 1.188 + ")")
            .attr("height", height / 10.3)
            .attr("fill", "#FF2700")
            .attr("opacity", 0.7);
        svg.append("rect")
            .attr("width", "82%")
            .attr("transform", "translate(200," + height / 1.067 + ")")
            .attr("height", height / 10.75)
            .attr("fill", "#FF0000")
            .attr("opacity", 0.8);

        // Creating Rect variable and appending SVG in the variable 
        var rect = svg.append("rect")
            .attr("transform", "translate(" + margin.left - 40 + "," + margin.top + ")")
            .attr("class", "overlay")
            .attr("id", "line01")
            .attr("width", width + 200)
            .attr("height", height + 300)
            .order("", 10)
            .on("mouseover", function () {
                focus.style("display", null)
                focus.style("color", "white");
            })
            .on("mouseout", function () {
                focus.style("display", "none");
            })
            .on("click", onClickEvent)

        // Appending trend line to svg 
        var line = d3.line()
            .curve(d3.curveCatmullRom.alpha(0.5))
            .x(function (d) {
                return x(d.date);
            })
            .y(function (d) {
                return y(d.score);
            })

        // Appending g element to svg 
        var g = svg.append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
        
        // Appending X-axis title 
        g.append("g")
            .attr("class", "axis axis--x")
            .attr("transform", "translate(0," + height + ")")
            .call(d3.axisBottom(x)
                .tickFormat(d3.timeFormat("%b-%d")))
            .style("color", "white")
            .append("text")
            .attr("class", "axis-title")
            .attr("x", width - 500)
            .attr("y", height - 540)
            .text("Time");

        // Appending SVG Title (Overall chart Title)
        g.append("g")
            .attr("class", "axis axis--x")
            .attr("transform", "translate(0," + height + ")")
            .call(d3.axisBottom(x)
                .tickFormat(d3.timeFormat("%b-%d")))
            .style("color", "white")
            .append("text")
            .attr("class", "axis-title")
            .attr("x", width - 550)
            .attr("y", height - 1170)
            .text("Tweet Sentiment Level vs Time").style("font-size", "24px").style("color", "rgb(26, 60,253)");
        
        // Appending Legend Title to SVG 
        g.append("g")
            .attr("class", "axis axis--x")
            .attr("transform", "translate(0," + height + ")")
            .call(d3.axisBottom(x)
                .tickFormat(d3.timeFormat("%b-%d")))
            .style("color", "white")
            .append("text")
            .attr("class", "axis-title")
            .attr("x", width - 550)
            .attr("y", height - 1150)
            .text("(Click circle to view Tweet)").style("font-size", "13px").style("color", "rgb(26, 60,253)");

        // Appending Stroke array parallel to x-axis form 0 to SVG
        g.append("g")
            .attr("class", "axisMid")
            .attr("transform", "translate(0," + height / 1.908 + ")")
            .style("stroke-dasharray", ("4"))
            .call(d3.axisBottom(x)
                .tickSize(0)
                .tickFormat(""))
            .style("opacity", "0.7");
        
        // Appending Y-axis title to svg 
        g.append("g")
            .attr("class", "axis axis--y")
            .call(d3.axisLeft(y).ticks(10).tickFormat(function (d) {
                return parseFloat(d);
            }))
            .append("text")
            .attr("class", "axis-title")
            .attr("transform", "rotate(-90)")
            .attr("x", -250)
            .attr("y", height - 780)
            .text("Sentiment Level");
        
        // Appending data for the line to SVG 
        g.append("path")
            .datum(data)
            .attr("class", "line")
            .attr("d", line)
            .attr("data-legend", function (d) {
                return d.date
            })

        // Appending Circular points on the line to SVG 
        g.selectAll('circle')
            .data(data).enter()
            .append('circle')
            .attr('cx', d => x(d.date))
            .attr('cy', d => y(d.score))
            .attr('r', 8)
            .on("mousemove", mousemove)
            .on("mouseover", function () {
                focus.style("display", null)
                focus.style("color", "white");
            })
            .on("click", onClickEvent);

        //Making SVG Responsive with viewBox 
        g.selectAll("text").data(data).enter()
            .append("text")
            .attr("x", function (d) {
                return x(d.date);
            })
            .attr("y", function (d) {
                return y(d.score);
            })
            .attr("viewBox", "0 0 740 800");
        var focus = g.append("g")
            .attr("class", "focus")
            .style("display", "none")
        
        // Appending hover line parallel to x-axis 
        focus.append("line")
            .attr("class", "x-hover-line hover-line")
            .attr("y1", 1)
            .attr("y2", height)

        // Appending hover line parallel to y-axis 
        focus.append("line")
            .attr("class", "y-hover-line hover-line")
            .attr("x1", width)
            .attr("x2", width);
        
        // Appending hover date for circular points 
        focus.append("text")
            .attr("class", "tooltip-date")
            .attr("x", -130)
            .attr("y", -35)
        
        // Appending Hover score for circular points 
        focus.append("text")
            .attr("class", "tooltip-likes")
            .attr("x", -130)
            .attr("y", -10)
            .attr("dy", "7px");

        // Function for hover on circular points on the trend line 
        function mousemove() {
            var x0 = x.invert(d3.mouse(this)[0]),
                i = bisectDate(data, x0, 0), 
                d0 = data[i - 1],
                d1 = data[i],
                d = x0 - d0.date > d1.date - x0 ? d1 : d0; 
            focus.attr("transform", "translate(" + x(d.date) + "," + y(d.score) + ")");
            focus.select(".tooltip-date").text("Date: " + d3.timeFormat("%b-%d")(d.date))
            focus.select(".tooltip-likes").text("Tweet: " + (d.tweet))
            focus.select(".tooltip-likes").text("Score: " + (d.score).toFixed(2))
            focus.select(".x-hover-line").attr("y2", height - y(d.score)).style("border", "solid");
            focus.style("color", "white");
        }


        // Function for onClick event on the circular points 
        function onClickEvent() {
            // Clearing page on Reload
            $('.feedback-form').empty();
            $('.wordchart-container').empty();
            $('#wordcloud').empty();
            $('.feedback-container-head').empty();
            //loading tweets into array
            var tweets_data = "";
            var x0 = x.invert(d3.mouse(this)[0]),
                i = bisectDate(data, x0, 0),
                d0 = data[i - 1],
                d1 = data[i],
                //loaded tweets
                d = x0 - d0.date > d1.date - x0 ? d1 : d0;
                var color = 'black';
            
            //generating popup dynamically showing all tweets
            //capture array only for date key

            // Appending Div elements in the page using JQuery 
            $(('<div><h4>' + "Tweets" + '</h4></div>')).appendTo(".feedback-form");
            $(('<div id="test" style="text-align:center; font-size:24px; font-weight:700">' + d3.timeFormat("%b-%d")
                (d.date))).appendTo(".feedback-form");
            $(("<table>")).appendTo(".feedback-form")
                // Loop to print notifiable tweets with red and normal ones with white 
                for (i = 0; i <= d.tweet.length - 1; i++) {
                tweets_data += (d.tweet[i] + ' ')
                if (d.is_noti[i] == true) {
                    $(('<div id="test" style="color:red;"><tr>' + [i + 1] + '. ' + d.tweet[i] +
                        '<br><hr></tr>')).appendTo(".feedback-form");
                } else {
                    $(('<div id="test" style="color:#fff"><tr>' + [i + 1] + '. ' + d.tweet[i] +
                            '<br><hr></tr>'))
                        .appendTo(
                            ".feedback-form");
                }

            }

            // Appending Date in the div with class feedback-container-head 
            $('<h4>' + d3.timeFormat("%b-%d-%Y")(d.date) + '</h4>').appendTo(".feedback-container-head");
            // Appending text in the div with class wordchart-container
            $('<h4>' + "Day's Tweet Timeline" + '</h4>').appendTo(".wordchart-container");
            $(("</table>")).appendTo(".feedback-form")
            // Appending wordcloud in the div with id wordcloud
            $('<h4>' + "Wordcloud" + '</h4>').appendTo("#wordcloud");
            // Appending background colour in the div with id wordcloud
            $('<br>' + '<div id="container" style:"background: #dbd8d8;">' + "</div>")
                .appendTo("#wordcloud");
            

            // Zingchart Code 
                zingchart.MODULESDIR = 'https://cdn.zingchart.com/modules/';
            let chartConfig = {
                type: 'wordcloud',
                backgroundColor: '#f9f9f9',
                fontColor: '#111',
                fontWeight: 'bold',

                aspect: "spiral",
                options: {
                    text: tweets_data,
                    aspect: 'spiral',
                    colorType: 'palette',
                    ignore: ["1", "2", "3", "4", "5", "6", "7", "8", "9", "0", "200", "a", "about", "above",
                        "after", "again", "against", "all", "am", "an",
                        "and",
                        "any", "are", "aren't", "as", "at", "be", "because", "been", "before", "being",
                        "below",
                        "between", "both", "but", "by", "can't", "cannot", "could", "couldn't", "did",
                        "didn't",
                        "do", "does", "doesn't", "doing", "don't", "down", "during", "each", "few",
                        "for", "from",
                        "further", "had", "hadn't", "has", "hasn't", "have", "haven't", "having", "he",
                        "he'd",
                        "he'll", "he's", "her", "here", "here's", "hers", "herself", "him", "himself",
                        "his", "how",
                        "how's", "i", "i'd", "i'll", "i'm", "i've", "if", "in", "into", "is", "isn't",
                        "it", "it's",
                        "its", "itself", "let's", "me", "more", "most", "mustn't", "my", "myself", "no",
                        "nor",
                        "not", "of", "off", "on", "once", "only", "or", "other", "ought", "our", "ours",
                        "ourselves", "out", "over", "own", "same", "shan't", "she", "she'd", "she'll",
                        "she's",
                        "should", "shouldn't", "so", "some", "such", "than", "that", "that's", "the",
                        "The",
                        "their",
                        "theirs", "them", "themselves", "then", "there", "there's", "these", "they",
                        "they'd",
                        "they'll", "they're", "they've", "this", "those", "through", "to", "too",
                        "under", "until",
                        "up", "very", "was", "wasn't", "we", "we'd", "we'll", "we're", "we've", "were",
                        "weren't",
                        "what", "what's", "when", "when's", "where", "where's", "which", "while", "who",
                        "who's",
                        "whom", "why", "why's", "with", "won't", "would", "wouldn't", "you", "you'd",
                        "you'll",
                        "you're", "you've", "your", "yours", "yourself", "yourselves"
                    ],
                    maxItems: 15,
                    minLength: '3px',
                    palette: ['#D32F2F', '#1976D2', '#111111', '#E53935', '#1E88E5', '#7E57C2',
                        '#F44336', '#2196F3', '#1e1e1e'
                    ],
                    rotate: true,
                    fontSize: '80px',
                    fontWeight: 'bold',
                    // Styling Zingchart 
                    style: {
                        tooltip: {

                            padding: '1px',
                            alpha: 3.9,
                            backgroundColor: '#D32F2F',
                            borderColor: 'none',
                            borderRadius: '3px',
                            fontColor: 'white',
                            fontFamily: 'Open Sans',
                            textAlpha: 6,
                            fontSize: '20px',
                            visible: true,
                            width: '300px',
                            wrapText: false,
                        },
                        fontFamily: 'Open Sans',
                        fontWeight: 'bold',
                        fontSize: '50px',
                        hoverState: {
                            backgroundColor: '#111',
                            borderColor: 'none',
                            borderRadius: '3px',
                            fontColor: 'white'
                        }
                    }
                }

            };

            // Rendering and showing Zingchart in Div element with ID container 
            zingchart.render({  
                id: 'container',
                data: chartConfig,
                fontWeight: 'bold',
                width: '80%',
                height: '90%',
                x: '500'
            });

            // Creating tweet-time array with date of the tweets, score and the tweet itself 
            var tweet_time = []
            for (i = 0; i <= d.time.length - 1; i++) {
                tweet_time.push({
                    "x": new Date(d.time[i]),
                    "y": d.t_score[i],
                    "tweet": d.tweet[i]
                })
            }

            // CanvasJS chart begins 
            var chart = new CanvasJS.Chart("chartContainer", {
                animationEnabled: true,
                zoomEnabled: true,
                backgroundColor: '#f9f9f9',
                fontColor: "#fff",
                axisX: {
                    title: "Time",
                    gridThickness: 0.5,
                    intervalType: "hour",


                },
                axisY: {
                    title: "Score",
                    minimum: -5,
                    maximum: 5,
                    gridThickness: 0.5,
                },
                data: [{
                    type: "scatter",
                    toolTipContent: "<b>Tweet </b>{tweet}<br /><b>Time: </b>{x} <br /><b>Score: </b>{y}",
                    dataPoints: tweet_time,
                    markerSize: 20,
                    markerColor: "#5a02ad",

                }]
            });
            // Rendering CanvasJS Scatterplot 
            chart.render();

            // Scroll effect to bottom of the page on clicking circular points 
            $('html, body').animate({
                scrollTop: $(".feedback-container-head").offset().top
            }, 1000);

        };

        var w = 104,
            h = 140;

            var colorScale = d3.scaleLinear()
            .domain([-5, 5])
            
        // Appending Legend to the SVG 
        var legend = svg.append("defs").append("svg:linearGradient").attr("id", "gradient").attr("x1",
            "100%").attr("y1", "0%").attr("x2", "100%").attr("y2", "100%").attr("spreadMethod", "pad");

        // Legend gradient 
        legend.append("stop").attr("offset", "0%").attr("stop-color", "#111").attr("stop-opacity", 1);
        // Legend gradient 
        legend.append("stop").attr("offset", "100%").attr("stop-color", "#111").attr("stop-opacity", 1);

        // Appending Legend line title 
        svg.append("text")
            .attr("class", "legendTitle")
            .attr("x", 1140)
            .attr("y", 77)
            .style("text-anchor", "left")
            .style("font-size", "15px")
            .style("font-weight", "700")
            .text("Tweets Trend");

        // Appending Y-axis sentiment level Titles 
        svg.append("text")
            .attr("class", "legendTitle")
            .attr("x", 10)
            .attr("y", 111)
            .style("text-anchor", "left")
            .style("font-size", "17px")
            .style("font-weight", "700")
            .text("(Extremely Positive)");

        // Appending Y-axis sentiment level Titles
        svg.append("text")
            .attr("class", "legendTitle")
            .attr("x", 98)
            .attr("y", 225)
            .style("text-anchor", "left")
            .style("font-size", "17px")
            .style("font-weight", "700")
            .text("(Positive)");

// Appending Y-axis sentiment level Titles
        svg.append("text")
            .attr("class", "legendTitle")
            .attr("x", 100)
            .attr("y", 340)
            .style("text-anchor", "left")
            .style("font-size", "17px")
            .style("font-weight", "700")
            .text("(Neutral)");
// Appending Y-axis sentiment level Titles
        svg.append("text")
            .attr("class", "legendTitle")
            .attr("x", 88)
            .attr("y", 455)
            .style("text-anchor", "left")
            .style("font-size", "17px")
            .style("font-weight", "700")
            .text("(Negative)");
// Appending Y-axis sentiment level Titles
        svg.append("text")
            .attr("class", "legendTitle")
            .attr("x", 3)
            .attr("y", 567)
            .style("text-anchor", "left")
            .style("font-size", "17px")
            .style("font-weight", "700")
            .text("(Extremely Negative)");

        // Appending Gradient Legend to svg 
        svg.append("rect").attr("width", w - 100).attr("height", h - 100).attr("y", -1120).attr("x", 70).style(
            "fill",
            "url(#gradient)").attr("transform", "translate(200,30)").attr("transform", "rotate(90)");

        // Creating range for the legend 
        var y1 = d3.scaleLinear().range([298, 0]).domain([-5, 0]);
        // Creating ticks for the legend 
        var yAxis = d3.axisBottom(y1).ticks(5).tickSize(1)

        // Clearing page on reload 
        $('.feedback-form').empty();
        $('.wordchart-container').empty();
        $('#wordcloud').empty();

        //Scroll to top button function call 
        window.onscroll = function () {
            scrollFunction()
        };

        // Scroll to top function 
        function scrollFunction() {
            if (document.body.scrollTop > 10 || document.documentElement.scrollTop > 10) {
                document.getElementById("top").style.display = "block";
            } else {
                document.getElementById("top").style.display = "none";
            }
        }

        // When the user clicks on the button, scroll to the top of the document
        function topFunction() {
            document.body.scrollTop = 0;
            document.documentElement.scrollTop = 0;
        }
    </script>
    </script>
</body>
</html>